<div class="container mt-4">
  <h2>Transferência entre Benefícios</h2>
  
  <div *ngIf="error" class="alert alert-danger alert-dismissible fade show">
    {{ error }}
    <button type="button" class="btn-close" (click)="error = null"></button>
  </div>

  <div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show">
    {{ successMessage }}
    <button type="button" class="btn-close" (click)="successMessage = null"></button>
  </div>

  <div *ngIf="loadingBeneficios" class="text-center">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Carregando...</span>
    </div>
  </div>

  <form *ngIf="!loadingBeneficios" (ngSubmit)="onSubmit()" #transferenciaForm="ngForm">
    <div class="mb-3">
      <label for="origemId" class="form-label">Benefício de Origem *</label>
      <select 
        class="form-select" 
        id="origemId" 
        name="origemId"
        [(ngModel)]="transferencia.origemId" 
        required
        #origemId="ngModel">
        <option value="0" disabled>Selecione...</option>
        <option *ngFor="let b of beneficios" [value]="b.id">
          {{ b.nome }} - R$ {{ b.valor | number:'1.2-2' }}
        </option>
      </select>
      <div *ngIf="origemId.invalid && origemId.touched" class="text-danger">
        Selecione o benefício de origem
      </div>
    </div>

    <div class="mb-3">
      <label for="destinoId" class="form-label">Benefício de Destino *</label>
      <select 
        class="form-select" 
        id="destinoId" 
        name="destinoId"
        [(ngModel)]="transferencia.destinoId" 
        required
        #destinoId="ngModel">
        <option value="0" disabled>Selecione...</option>
        <option *ngFor="let b of beneficios" [value]="b.id">
          {{ b.nome }} - R$ {{ b.valor | number:'1.2-2' }}
        </option>
      </select>
      <div *ngIf="destinoId.invalid && destinoId.touched" class="text-danger">
        Selecione o benefício de destino
      </div>
    </div>

    <div class="mb-3">
      <label for="valor" class="form-label">Valor *</label>
      <div class="input-group">
        <span class="input-group-text">R$</span>
        <input 
          type="number" 
          class="form-control" 
          id="valor" 
          name="valor"
          [(ngModel)]="transferencia.valor" 
          required 
          min="0.01"
          step="0.01"
          #valor="ngModel">
      </div>
      <div *ngIf="valor.invalid && valor.touched" class="text-danger">
        Valor deve ser maior que zero
      </div>
    </div>

    <div class="mb-3">
      <button 
        type="submit" 
        class="btn btn-success" 
        [disabled]="transferenciaForm.invalid || loading">
        <span *ngIf="loading" class="spinner-border spinner-border-sm me-1"></span>
        Transferir
      </button>
      <a routerLink="/" class="btn btn-secondary ms-2">Cancelar</a>
    </div>
  </form>

  <div *ngIf="beneficios.length < 2" class="alert alert-warning">
    É necessário ter pelo menos 2 benefícios ativos para realizar transferências.
  </div>
</div>